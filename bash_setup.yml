
- name: Install traceroute
  become: yes
  apt:
    name: traceroute
    state: present

- name: add getip function to the shell setup
  become: yes
  become_user: "{{ user_name }}"
  lineinfile:
    path: "{{ shell_config_file }}"
    line: "{{ item }}"
  with_items:
     - 'getip() { (traceroute $1 2>&1 | head -n 1 | cut -d\( -f 2 | cut -d\) -f 1) }'
     - 'genpasswd() { (local l=$1; [ "$l" == "" ] && l=8; tr -dc A-Za-z0-9_.$!- < /dev/urandom | head -c "${l}" | xargs) }'